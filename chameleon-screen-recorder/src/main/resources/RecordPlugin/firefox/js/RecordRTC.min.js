"use strict";function RecordRTC(a,b){function d(){return b.disableLogs||console.debug("started recording "+b.type+" stream."),n?(n.clearRecordedData(),n.record(),l("recording"),c.recordingDuration&&k(),c):(e(function(){c.recordingDuration&&k()}),c)}function e(c){c&&(b.initCallback=function(){c(),c=b.initCallback=null});var d=new GetRecorderType(a,b);n=new d(a,b),n.record(),l("recording"),b.disableLogs||console.debug("Initialized recorderType:",n.constructor.name,"for output-type:",b.type)}function f(a){function d(d){Object.keys(n).forEach(function(a){"function"!=typeof n[a]&&(c[a]=n[a])});var e=n.blob;if(!e){if(!d)throw"Recording failed.";n.blob=e=d}if(a){var f=e;"function"==typeof a.call?a.call(c,f):a(f)}if(b.autoWriteToDisk){var g={};g[b.type+"Blob"]=e,DiskStorage.Store(g)}e&&!b.disableLogs&&console.debug("->",e)}return n?"paused"===c.state?(l("recording"),c.resumeRecording(),void setTimeout(function(){f(a)},1)):"recording"!==c.state?void(b.disableLogs||console.warn("Unable to stop the recording. Recording state: ",c.state)):(b.disableLogs||console.warn("Stopped recording "+b.type+" stream."),n.stop(d),void l("stopped")):console.warn(m)}function g(){return n?"recording"!==c.state?void(b.disableLogs||console.warn("Unable to pause the recording. Recording state: ",c.state)):(l("paused"),n.pause(),void(b.disableLogs||console.debug("Paused recording."))):console.warn(m)}function h(){return n?"paused"!==c.state?void(b.disableLogs||console.warn("Unable to resume the recording. Recording state: ",c.state)):(l("recording"),n.resume(),void(b.disableLogs||console.debug("Resumed recording."))):console.warn(m)}function i(a){postMessage((new FileReaderSync).readAsDataURL(a))}function j(a,c){function g(a){var b=URL.createObjectURL(new Blob([a.toString(),"this.onmessage =  function (e) {"+a.name+"(e.data);}"],{type:"application/javascript"})),c=new Worker(b);return URL.revokeObjectURL(b),c}if(!a)throw"Pass a callback function over getDataURL.";var d=c?c.blob:(n||{}).blob;if(!d)return b.disableLogs||console.warn("Blob encoder did not finish its job yet."),void setTimeout(function(){j(a,c)},1e3);if("undefined"==typeof Worker||navigator.mozGetUserMedia){var f=new FileReader;f.readAsDataURL(d),f.onload=function(b){a(b.target.result)}}else{var e=g(i);e.onmessage=function(b){a(b.data)},e.postMessage(d)}}function k(a){if(a=a||0,"paused"===c.state)return void setTimeout(function(){k(a)},1e3);if("stopped"!==c.state){if(a>=c.recordingDuration)return void f(c.onRecordingStopped);a+=1e3,setTimeout(function(){k(a)},1e3)}}function l(a){c.state=a,"function"==typeof c.onStateChanged.call?c.onStateChanged.call(c,a):c.onStateChanged(a)}if(!a)throw"First parameter is required.";b=b||{type:"video"},b=new RecordRTCConfiguration(a,b);var n,c=this,m='It seems that "startRecording" is not invoked for '+b.type+" recorder.",o={startRecording:d,stopRecording:f,pauseRecording:g,resumeRecording:h,initRecorder:e,setRecordingDuration:function(a,b){if(void 0===a)throw"recordingDuration is required.";if("number"!=typeof a)throw"recordingDuration must be a number.";return c.recordingDuration=a,c.onRecordingStopped=b||function(){},{onRecordingStopped:function(a){c.onRecordingStopped=a}}},clearRecordedData:function(){if(!n)return console.warn(m);n.clearRecordedData(),b.disableLogs||console.debug("Cleared old recorded data.")},getBlob:function(){return n?n.blob:console.warn(m)},getDataURL:j,toURL:function(){return n?n.blob:console.warn(m)},addStream:function(a){if(!n)return console.warn(m);"function"==typeof n.addStream&&n.addStream(a)},save:function(a){if(!n)return console.warn(m);invokeSaveAsDialog(n.blob,a)},getFromDisk:function(a){if(!n)return console.warn(m);RecordRTC.getFromDisk(b.type,a)},setAdvertisementArray:function(a){b.advertisement=[];for(var c=a.length,d=0;d<c;d++)b.advertisement.push({duration:d,image:a[d]})},blob:null,reset:function(){n&&"function"==typeof n.clearRecordedData&&n.clearRecordedData(),n=null,l("inactive"),c.blob=null},onStateChanged:function(a){b.disableLogs||console.info("Recorder state changed:",a)},state:"inactive"};if(!this)return c=o,o;for(var p in o)this[p]=o[p];return c=this,o}function RecordRTCConfiguration(a,b){return b.recorderType&&!b.type&&b.recorderType===MediaStreamRecorder&&(a.getAudioTracks().length&&a.getVideoTracks().length?b.type="video":a.getAudioTracks().length&&!a.getVideoTracks().length?b.type="audio":!a.getAudioTracks().length&&a.getVideoTracks().length&&(b.type="audio")),void 0!==MediaStreamRecorder&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(b.mimeType||(b.mimeType="video/webm"),b.type||(b.type=b.mimeType.split("/")[0]),b.bitsPerSecond),b.type||(b.mimeType&&(b.type=b.mimeType.split("/")[0]),b.type||(b.type="audio")),b}function GetRecorderType(a,b){var c;return"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&!isChrome&&(c=MediaStreamRecorder),isMediaRecorderCompatible()&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(a.getVideoTracks&&a.getVideoTracks().length||a.getAudioTracks&&a.getAudioTracks().length)&&("audio"===b.type?"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("audio/webm")&&(c=MediaStreamRecorder):"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("video/webm")&&(c=MediaStreamRecorder)),b.recorderType&&(c=b.recorderType),a instanceof Array&&a.length&&(c=MultiStreamRecorder),!b.disableLogs&&c&&c.name&&console.debug("Using recorderType:",c.name||c.constructor.name),c}function MRecordRTC(a){this.addStream=function(b){b&&(a=b)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){var c,b=this.mediaType,d=this.mimeType||{audio:null,video:null};if("function"!=typeof b.audio&&isMediaRecorderCompatible()&&a.getAudioTracks&&!a.getAudioTracks().length&&(b.audio=!1),"function"!=typeof b.video&&isMediaRecorderCompatible()&&a.getVideoTracks&&!a.getVideoTracks().length&&(b.video=!1),!b.audio&&!b.video)throw"MediaStream must have either audio or video tracks.";if(b.audio&&(c=null,"function"==typeof b.audio&&(c=b.audio),this.audioRecorder=new RecordRTC(a,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:c,mimeType:d.audio}),b.video||this.audioRecorder.startRecording()),b.video){c=null,"function"==typeof b.video&&(c=b.video);var e=a;if(isMediaRecorderCompatible()&&b.audio&&"function"==typeof b.audio){var f=a.getVideoTracks()[0];navigator.mozGetUserMedia?(e=new MediaStream,e.addTrack(f),c&&(c=MediaStreamRecorder)):e=new MediaStream([f])}this.videoRecorder=new RecordRTC(e,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:c,mimeType:d.video}),b.audio||this.videoRecorder.startRecording()}if(b.audio&&b.video){var g=this;isMediaRecorderCompatible()?(g.audioRecorder=null,g.videoRecorder.startRecording()):g.videoRecorder.initRecorder(function(){g.audioRecorder.initRecorder(function(){g.videoRecorder.startRecording(),g.audioRecorder.startRecording()})})}},this.stopRecording=function(a){a=a||function(){},this.audioRecorder&&this.audioRecorder.stopRecording(function(b){a(b,"audio")}),this.videoRecorder&&this.videoRecorder.stopRecording(function(b){a(b,"video")})},this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording(),this.videoRecorder&&this.videoRecorder.pauseRecording()},this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording(),this.videoRecorder&&this.videoRecorder.resumeRecording()},this.getBlob=function(a){var b={};return this.audioRecorder&&(b.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(b.video=this.videoRecorder.getBlob()),a&&a(b),b},this.getDataURL=function(a){function b(a,b){if("undefined"!=typeof Worker){var d=c(function(b){postMessage((new FileReaderSync).readAsDataURL(b))});d.onmessage=function(a){b(a.data)},d.postMessage(a)}else{var e=new FileReader;e.readAsDataURL(a),e.onload=function(a){b(a.target.result)}}}function c(a){var d,b=URL.createObjectURL(new Blob([a.toString(),"this.onmessage =  function (e) {"+a.name+"(e.data);}"],{type:"application/javascript"})),c=new Worker(b);if(void 0!==URL)d=URL;else{if("undefined"==typeof webkitURL)throw"Neither URL nor webkitURL detected.";d=webkitURL}return d.revokeObjectURL(b),c}this.getBlob(function(c){c.audio&&c.video?b(c.audio,function(d){b(c.video,function(b){a({audio:d,video:b})})}):c.audio?b(c.audio,function(b){a({audio:b})}):c.video&&b(c.video,function(b){a({video:b})})})},this.writeToDisk=function(){RecordRTC.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder})},this.save=function(a){a=a||{audio:!0,video:!0},a.audio&&this.audioRecorder&&this.audioRecorder.save("string"==typeof a.audio?a.audio:""),a.video&&this.videoRecorder&&this.videoRecorder.save("string"==typeof a.video?a.video:"")}}function bytesToSize(a){var b=1e3,c=["Bytes","KB","MB","GB","TB"];if(0===a)return"0 Bytes";var d=parseInt(Math.floor(Math.log(a)/Math.log(b)),10);return(a/Math.pow(b,d)).toPrecision(3)+" "+c[d]}function invokeSaveAsDialog(a,b){if(!a)throw"Blob object is required.";if(!a.type)try{a.type="video/webm"}catch(a){}var c=(a.type||"video/webm").split("/")[1];if(b&&-1!==b.indexOf(".")){var d=b.split(".");b=d[0],c=d[1]}var e=(b||Math.round(9999999999*Math.random())+888888888)+"."+c;if(void 0!==navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(a,e);if(void 0!==navigator.msSaveBlob)return navigator.msSaveBlob(a,e);var f=document.createElement("a");f.href=URL.createObjectURL(a),f.target="_blank",f.download=e,navigator.mozGetUserMedia&&(f.onclick=function(){(document.body||document.documentElement).removeChild(f)},(document.body||document.documentElement).appendChild(f));var g=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});f.dispatchEvent(g),navigator.mozGetUserMedia||URL.revokeObjectURL(f.href)}function isMediaRecorderCompatible(){var a=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,b=!!window.chrome&&!a;if(void 0!==window.InstallTrigger)return!0;var i,j,e=(navigator.appVersion,navigator.userAgent),f=""+parseFloat(navigator.appVersion),g=parseInt(navigator.appVersion,10);return(b||a)&&(i=e.indexOf("Chrome"),f=e.substring(i+7)),-1!==(j=f.indexOf(";"))&&(f=f.substring(0,j)),-1!==(j=f.indexOf(" "))&&(f=f.substring(0,j)),g=parseInt(""+f,10),isNaN(g)&&(f=""+parseFloat(navigator.appVersion),g=parseInt(navigator.appVersion,10)),g>=49}function MediaStreamRecorder(a,b){function f(){if("active"in a){if(!a.active)return!1}else if("ended"in a&&a.ended)return!1;return!0}var c=this;if(b=b||{mimeType:"video/webm"},"audio"===b.type){if(a.getVideoTracks().length&&a.getAudioTracks().length){var d;navigator.mozGetUserMedia?(d=new MediaStream,d.addTrack(a.getAudioTracks()[0])):d=new MediaStream(a.getAudioTracks()),a=d}b.mimeType&&-1!==b.mimeType.toString().toLowerCase().indexOf("audio")||(b.mimeType=isChrome?"audio/webm":"audio/ogg"),b.mimeType&&"audio/ogg"!==b.mimeType.toString().toLowerCase()&&navigator.mozGetUserMedia&&(b.mimeType="audio/ogg")}this.record=function(){c.blob=null;var d=b;b.disableLogs||console.log("Passing following config over MediaRecorder API.",d),e&&(e=null),isChrome&&!isMediaRecorderCompatible()&&(d="video/vp8"),"function"==typeof MediaRecorder.isTypeSupported&&d.mimeType&&(MediaRecorder.isTypeSupported(d.mimeType)||(b.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",d.mimeType),d.mimeType="audio"===b.type?"audio/webm":"video/webm"));try{e=new MediaRecorder(a,d)}catch(b){e=new MediaRecorder(a)}!MediaRecorder.isTypeSupported&&"canRecordMimeType"in e&&!1===e.canRecordMimeType(b.mimeType)&&(b.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",b.mimeType)),e.ignoreMutedMedia=b.ignoreMutedMedia||!1,e.ondataavailable=function(a){if(!c.dontFireOnDataAvailableEvent){if(!a.data||!a.data.size||a.data.size<100||c.blob)return void(c.recordingCallback&&(c.recordingCallback(new Blob([],{type:d.mimeType||"video/webm"})),c.recordingCallback=null));c.blob=URL.createObjectURL(a.data,{type:d.mimeType||"video/webm"}),c.recordingCallback&&(c.recordingCallback(c.blob),c.recordingCallback=null)}},e.onerror=function(a){b.disableLogs||("InvalidState"===a.name?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed."):"OutOfMemory"===a.name?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute."):"IllegalStreamModification"===a.name?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute."):"OtherRecordingError"===a.name?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute."):"GenericError"===a.name?console.error("The UA cannot provide the codec or recording option that has been requested.",a):console.error("MediaRecorder Error",a)),function(a){if(!c.manuallyStopped&&e&&"inactive"===e.state)return void e.start(6e5);setTimeout(a,1e3)}(),"inactive"!==e.state&&"stopped"!==e.state&&e.stop()},e.start(),b.onAudioProcessStarted&&b.onAudioProcessStarted(),b.initCallback&&b.initCallback()},this.stop=function(a){c.manuallyStopped=!0,e&&(this.recordingCallback=function(b){e=null,a&&a(b)},"recording"===e.state&&e.stop())},this.pause=function(){e&&"recording"===e.state&&e.pause()},this.resume=function(){if(this.dontFireOnDataAvailableEvent){this.dontFireOnDataAvailableEvent=!1;var a=b.disableLogs;return b.disableLogs=!0,this.record(),void(b.disableLogs=a)}e&&"paused"===e.state&&e.resume()},this.clearRecordedData=function(){e&&(this.pause(),this.dontFireOnDataAvailableEvent=!0,this.stop())};var e,c=this;!function a(){if(e)return!1===f()?(b.disableLogs||console.log("MediaStream seems stopped."),void c.stop()):void setTimeout(a,1e3)}()}function MultiStreamRecorder(a,b){function d(){Storage.AudioContextConstructor||(Storage.AudioContextConstructor=new Storage.AudioContext),c.audioContext=Storage.AudioContextConstructor,c.audioSources=[],c.gainNode=c.audioContext.createGain(),c.gainNode.connect(c.audioContext.destination),c.gainNode.gain.value=0;var b=0;if(a.forEach(function(a){if(a.getAudioTracks().length){b++;var d=c.audioContext.createMediaStreamSource(a);d.connect(c.gainNode),c.audioSources.push(d)}}),b)return c.audioDestination=c.audioContext.createMediaStreamDestination(),c.audioSources.forEach(function(a){a.connect(c.audioDestination)}),c.audioDestination.stream}function g(){a.forEach(function(a){if(a.getVideoTracks().length){var c=h(a);c.width=b.video.width,c.height=b.video.height,c.stream=a,e.push(c)}});var c;return"captureStream"in l?c=l.captureStream():"mozCaptureStream"in l?c=l.mozCaptureStream():b.disableLogs||console.error("Upgrade to latest Chrome or otherwise enable this flag: chrome://flags/#enable-experimental-web-platform-features"),l.stream=c,c}function h(a){var b=document.createElement("video");return b.src=URL.createObjectURL(a),b.muted=!0,b.volume=0,b.play(),b}function j(){if(!i){var a=e.length,c=!1;e.forEach(function(a){a.stream||(a.stream={}),a.stream.fullcanvas&&(c=a.stream)}),c?(l.width=c.width,l.height=c.height):(l.width=a>1?2*e[0].width:e[0].width,l.height=a>2?2*e[0].height:e[0].height),e.forEach(k),setTimeout(j,b.frameInterval)}}function k(a,b){if(!i){var c=0,d=0,e=a.width,f=a.height;1===b&&(c=a.width),2===b&&(d=a.height),3===b&&(c=a.width,d=a.height),void 0!==a.stream.left&&(c=a.stream.left),void 0!==a.stream.top&&(d=a.stream.top),void 0!==a.stream.width&&(e=a.stream.width),void 0!==a.stream.height&&(f=a.stream.height),m.drawImage(a,c,d,e,f),"function"==typeof a.stream.onRender&&a.stream.onRender(m,c,d,e,f,a.stream)}}var c=this;b=b||{mimeType:"video/webm",video:{width:360,height:240}},b.frameInterval||(b.frameInterval=10),b.video||(b.video={}),b.video.width||(b.video.width=360),b.video.height||(b.video.height=240),this.record=function(){i=!1;var a=g(),c=d();c&&c.getAudioTracks().forEach(function(b){a.addTrack(b)}),b.previewStream&&"function"==typeof b.previewStream&&b.previewStream(a),f=new MediaStreamRecorder(a,b),j(),f.record()},this.stop=function(a){i=!0,f&&f.stop(function(b){a(b),c.clearRecordedData()})};var f,e=[],i=!1,l=document.createElement("canvas"),m=l.getContext("2d");l.style="opacity:0;position:absolute;z-index:-1;top: -100000000;left:-1000000000;",(document.body||document.documentElement).appendChild(l),this.pause=function(){f&&f.pause()},this.resume=function(){f&&f.resume()},this.clearRecordedData=function(){e=[],i=!0,f&&f.clearRecordedData(),f=null,c.gainNode&&(c.gainNode.disconnect(),c.gainNode=null),c.audioSources.length&&(c.audioSources.forEach(function(a){a.disconnect()}),c.audioSources=[]),c.audioDestination&&(c.audioDestination.disconnect(),c.audioDestination=null),c.audioContext=null,m.clearRect(0,0,l.width,l.height),l.stream&&(l.stream.stop(),l.stream=null)},this.addStream=function(d){if(d instanceof Array&&d.length)return void d.forEach(this.addStream);if(a.push(d),f){if(d.getVideoTracks().length){var g=h(d);g.width=b.video.width,g.height=b.video.height,g.stream=d,e.push(g)}if(d.getAudioTracks().length&&c.audioContext){var i=c.audioContext.createMediaStreamSource(d);i.connect(c.audioDestination),c.audioSources.push(i)}}}}function RecordRTCPromisesHandler(a,b){if(!this)throw'Use "new RecordRTCPromisesHandler()"';var c=this;c.recordRTC=new RecordRTC(a,b),this.startRecording=function(){return new Promise(function(a,b){try{c.recordRTC.startRecording(),a()}catch(a){b(a)}})},this.stopRecording=function(){return new Promise(function(a,b){try{c.recordRTC.stopRecording(function(b){c.blob=c.recordRTC.getBlob(),a(b)})}catch(a){b(a)}})},this.getDataURL=function(a){return new Promise(function(a,b){try{c.recordRTC.getDataURL(function(b){a(b)})}catch(a){b(a)}})},this.getBlob=function(){return c.recordRTC.getBlob()},this.blob=null}RecordRTC.getFromDisk=function(a,b){if(!b)throw"callback is mandatory.";console.log("Getting recorded "+("all"===a?"blobs":a+" blob ")+" from disk!"),DiskStorage.Fetch(function(c,d){"all"!==a&&d===a+"Blob"&&b&&b(c),"all"===a&&b&&b(c,d.replace("Blob",""))})},RecordRTC.writeToDisk=function(a){console.log("Writing recorded blob(s) to disk!"),a=a||{},a.video.getDataURL(function(a){DiskStorage.Store({videoBlob:a})})},"undefined"!=typeof module&&(module.exports=RecordRTC),"function"==typeof define&&define.amd&&define("RecordRTC",[],function(){return RecordRTC}),MRecordRTC.getFromDisk=RecordRTC.getFromDisk,MRecordRTC.writeToDisk=RecordRTC.writeToDisk,void 0!==RecordRTC&&(RecordRTC.MRecordRTC=MRecordRTC);var browserFakeUserAgent="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";!function(a){a&&"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:browserFakeUserAgent,getUserMedia:function(){}},global.console||(global.console={}),void 0===global.console.debug&&(global.console.debug=global.console.info=global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(a.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){var a={getContext:function(){return a},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return a},a.HTMLVideoElement=function(){}),"undefined"==typeof location&&(a.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(a.screen={width:0,height:0}),void 0===URL&&(a.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),a.window=global)}("undefined"!=typeof global?global:null);var AudioContext=window.AudioContext;void 0===AudioContext&&("undefined"!=typeof webkitAudioContext&&(AudioContext=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(AudioContext=mozAudioContext));var URL=window.URL;void 0===URL&&"undefined"!=typeof webkitURL&&(URL=webkitURL),"undefined"!=typeof navigator&&void 0===navigator.getUserMedia&&(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var isEdge=!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveBlob&&!navigator.msSaveOrOpenBlob),isOpera=!!window.opera||-1!==navigator.userAgent.indexOf("OPR/"),isChrome=!isOpera&&!isEdge&&!!navigator.webkitGetUserMedia,MediaStream=window.MediaStream;void 0===MediaStream&&"undefined"!=typeof webkitMediaStream&&(MediaStream=webkitMediaStream),void 0!==MediaStream&&("getVideoTracks"in MediaStream.prototype||(MediaStream.prototype.getVideoTracks=function(){if(!this.getTracks)return[];var a=[];return this.getTracks.forEach(function(b){-1!==b.kind.toString().indexOf("video")&&a.push(b)}),a},MediaStream.prototype.getAudioTracks=function(){if(!this.getTracks)return[];var a=[];return this.getTracks.forEach(function(b){-1!==b.kind.toString().indexOf("audio")&&a.push(b)}),a}),"stop"in MediaStream.prototype||(MediaStream.prototype.stop=function(){this.getAudioTracks().forEach(function(a){a.stop&&a.stop()}),this.getVideoTracks().forEach(function(a){a.stop&&a.stop()})}));var Storage={};void 0!==AudioContext?Storage.AudioContext=AudioContext:"undefined"!=typeof webkitAudioContext&&(Storage.AudioContext=webkitAudioContext),void 0!==RecordRTC&&(RecordRTC.Storage=Storage),void 0!==RecordRTC&&(RecordRTC.MediaStreamRecorder=MediaStreamRecorder);var DiskStorage={init:function(){function f(b){b.createObjectStore(a.dataStoreName)}function g(){function c(c){b.objectStore(a.dataStoreName).get(c).onsuccess=function(b){a.callback&&a.callback(b.target.result,c)}}var b=d.transaction([a.dataStoreName],"readwrite");a.videoBlob&&(console.warn("putInDB"),b.objectStore(a.dataStoreName).put(a.videoBlob,"videoBlob")),c("videoBlob")}var a=this;if("undefined"==typeof indexedDB||void 0===indexedDB.open)return void console.error("IndexedDB API are not available in this browser.");var d,b=1,c=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),e=indexedDB.open(c,b);e.onerror=a.onError,e.onsuccess=function(){if(d=e.result,d.onerror=a.onError,d.setVersion)if(d.version!==b){var c=d.setVersion(b);c.onsuccess=function(){f(d),g()}}else g();else g()},e.onupgradeneeded=function(a){f(a.target.result)}},Fetch:function(a){return this.callback=a,this.init(),this},Store:function(a){return this.videoBlob=a.videoBlob,this.init(),this},onError:function(a){console.error(JSON.stringify(a,null,"\t"))},dataStoreName:"recordRTC",dbName:null};void 0!==RecordRTC&&(RecordRTC.DiskStorage=DiskStorage),void 0!==RecordRTC&&(RecordRTC.MultiStreamRecorder=MultiStreamRecorder),void 0!==RecordRTC&&(RecordRTC.RecordRTCPromisesHandler=RecordRTCPromisesHandler);
